{% extends 'base_project.html' %}
{% load static %}
{% block title %}Évaluations Acheteur - {{ supplier.nom_complet_organisation }}{% endblock %}
{% block extra_css %}
<style>
  .page-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .page-header h1 { font-size:26px; color:#333; margin:0; }
  .mini-counter { display:flex; align-items:center; justify-content:center; gap:8px; width:max-content; margin: 0 auto 10px auto; padding:6px 12px; border:1px solid #e5eaf2; border-radius:999px; background:#fff; color:#FF5722; font-weight:600; font-size:13px; }
  .table-container { background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); overflow:hidden; }
  table { width:100%; border-collapse: collapse; }
  thead th { background:#fff3e0; color:#E64A19; font-weight:700; padding:12px; text-align:left; border-bottom:1px solid #f3e5f5; }
  tbody td { padding:12px; border-bottom:1px solid #f5f5f5; font-size:14px; color:#333; }
  .badge { padding:4px 10px; border-radius:12px; font-size:12px; font-weight:600; display:inline-block; }
  .badge-success { background:#e8f5e9; color:#2e7d32; }
  .badge-primary { background:#e3f2fd; color:#1976d2; }
  .badge-warning { background:#fff3e0; color:#f57c00; }
  .badge-danger { background:#ffebee; color:#c62828; }
  .actions { display:flex; gap:8px; }
  .btn { padding:8px 12px; border-radius:6px; border:1px solid #ddd; text-decoration:none; font-weight:600; }
  .btn-primary { background:#FF5722; color:#fff; border-color:#FF5722; }
  .btn-outline { background:#fff; color:#FF5722; border-color:#FF5722; }
</style>
{% endblock %}

{% block content %}
<div style="padding:20px;">
  <div class="page-header">
    <h1><i class='bx bx-shopping-bag'></i> Évaluations Acheteur — {{ supplier.nom_complet_organisation }}</h1>
    <a href="{% url 'evaluations:buyer_create' %}?supplier={{ supplier.id }}" class="btn btn-primary">
      <i class='bx bx-plus'></i> Nouvelle évaluation
    </a>
  </div>

  <div class="mini-counter">
    <i class='bx bx-bar-chart-alt-2'></i>
    <span>{{ stats.total }} évaluations • Moyenne {{ stats.avg_rating|floatformat:2 }}/10</span>
  </div>

  {% if evaluations %}
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Note</th>
          <th>Prix</th>
          <th>Délais RFX</th>
          <th>Conseil</th>
          <th>Relation</th>
          <th>Qualité RFX</th>
          <th>Crédit</th>
          <th>Évaluateur</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for e in evaluations %}
        <tr>
          <td>{{ e.date_evaluation|date:"d/m/Y" }}</td>
          <td>
            <strong>{{ e.buyer_final_rating }}/10</strong>
            {% with badge=e.get_rating_badge %}
            <span class="badge badge-{{ badge.class }}">{{ badge.label }}</span>
            {% endwith %}
          </td>
          <td>{{ e.price_flexibility }}</td>
          <td>{{ e.rfx_deadline_compliance }}</td>
          <td>{{ e.advisory_capability }}</td>
          <td>{{ e.relationship_quality }}</td>
          <td>{{ e.rfx_response_quality }}</td>
          <td>{{ e.credit_policy }}</td>
          <td>{{ e.evaluator.email|default:"N/A" }}</td>
          <td class="actions">
            <a href="{% url 'evaluations:buyer_detail' e.pk %}" class="btn btn-outline"><i class='bx bx-show'></i></a>
            <a href="{% url 'evaluations:buyer_edit' e.pk %}" class="btn btn-outline"><i class='bx bx-edit'></i></a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p style="text-align:center; color:#999;">Aucune évaluation pour ce fournisseur.</p>
  {% endif %}
</div>
{% endblock %}
